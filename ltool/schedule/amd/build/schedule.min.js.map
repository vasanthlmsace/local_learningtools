{"version":3,"sources":["../src/schedule.js"],"names":["define","Fragment","ModalFactory","String","ModalEvents","Notification","LearningToolSchedule","params","self","scheduleInfo","document","querySelector","schedulehovercolor","getAttribute","schedulefontcolor","addEventListener","style","background","color","displaySchedulebox","prototype","strschedule","get_string","create","title","type","types","SAVE_CANCEL","body","getScheduleAction","large","then","modal","show","getRoot","on","hidden","destroy","save","e","preventDefault","innerform","querySelectorAll","schedulenameinfo","value","submitFormData","contextid","submit","hide","window","location","reload","fail","exception","modalform","formData","URLSearchParams","FormData","toString","loadFragment","click","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Schedule ltool define js.\r\n * @module   ltool_schedule\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n define(['core/fragment', 'core/modal_factory', 'core/str', 'core/modal_events', 'core/notification'],\r\n function(Fragment, ModalFactory, String, ModalEvents, Notification) {\r\n\r\n    /**\r\n     * Controls Schedule tool action.\r\n     * @param {object} params\r\n     */\r\n    var LearningToolSchedule = function(params) {\r\n        var self = this;\r\n        var scheduleInfo = document.querySelector(\".ltoolschedule-info #ltoolschedule-action\");\r\n        if (scheduleInfo) {\r\n            // Hover color.\r\n            var schedulehovercolor = scheduleInfo.getAttribute(\"data-hovercolor\");\r\n            var schedulefontcolor = scheduleInfo.getAttribute(\"data-fontcolor\");\r\n            if (schedulehovercolor && schedulefontcolor) {\r\n                scheduleInfo.addEventListener(\"mouseover\", function() {\r\n                    document.querySelector('#ltoolschedule-action p').style.background = schedulehovercolor;\r\n                    document.querySelector('#ltoolschedule-action p').style.color = schedulefontcolor;\r\n                });\r\n            }\r\n            scheduleInfo.addEventListener('click', function() {\r\n                self.displaySchedulebox(params);\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n    LearningToolSchedule.prototype.displaySchedulebox = function(params) {\r\n        var self = this;\r\n        var strschedule = String.get_string('schedule', 'local_learningtools');\r\n        ModalFactory.create({\r\n            title: strschedule,\r\n            type: ModalFactory.types.SAVE_CANCEL,\r\n            body: self.getScheduleAction(params),\r\n            large: true\r\n        }).then(function(modal) {\r\n            modal.show();\r\n            modal.getRoot().on(ModalEvents.hidden, function() {\r\n                modal.destroy();\r\n            });\r\n\r\n            modal.getRoot().on(ModalEvents.save, function(e) {\r\n                e.preventDefault();\r\n                var innerform = document.querySelectorAll('#ltoolschedule-editorbox form')[0];\r\n                if (innerform) {\r\n                    innerform.addEventListener('submit', function(e) {\r\n                        e.preventDefault();\r\n                    });\r\n                }\r\n\r\n                var schedulenameinfo = document.querySelectorAll(\"#ltoolschedule-editorbox input[name='schedulename']\")[0];\r\n                if (schedulenameinfo.value) {\r\n                    self.submitFormData(params.contextid);\r\n                    modal.getRoot().submit();\r\n                    modal.hide();\r\n                    window.location.reload();\r\n                }\r\n            });\r\n            return modal;\r\n        }).fail(Notification.exception);\r\n\r\n    };\r\n\r\n    LearningToolSchedule.prototype.submitFormData = function(contextid) {\r\n        var modalform = document.querySelectorAll('#ltoolschedule-editorbox form')[0];\r\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\r\n        Fragment.loadFragment('ltool_schedule', 'set_calendar_event', contextid, {'formdata': formData});\r\n        modalform.querySelector(\"input[name=submitbutton]\").click();\r\n        return true;\r\n    };\r\n\r\n    LearningToolSchedule.prototype.getScheduleAction = function(params) {\r\n        return Fragment.loadFragment('ltool_schedule', 'get_schedule_form', params.contextid, params);\r\n    };\r\n\r\n    return {\r\n        init: function(params) {\r\n            return new LearningToolSchedule(params);\r\n        }\r\n    };\r\n });"],"file":"schedule.min.js"}